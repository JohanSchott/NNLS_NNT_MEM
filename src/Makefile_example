# Modules

# On Matter:
# module load intel/12.1.4  mkl/10.3.10.319

# On India:
# module load gcc/default  atlas/3.9.33/gcc

#--------------------------------------------------------------------------------------------------------------------------
# object files
OBJS = fz.o settingm.o matlab.o openm.o savem.o leastsquare.o tikhonovm.o asym.o eigenm.o maxentm.o input.o smearm.o gitversion.o readinpm.o acm.o saveacm.o main.o

# binary:
PROG =  ./NNLS_NNT_MEM

#-----------------------------------------------------------------------------------------------------------------------

# Libraries

# On India:
#LIBS = -L${LIBRARY_PATH}  -llapack -lf77blas -lcblas -latlas -L${ZGELSQUAD} -lzgelsquad -L${DGELSDQUAD} -ldgelsdquad

# On matter:
#LIBS = -L$(ZGELSQUAD)  -lzgelsquad  -Nmkl -mkl=sequential

# On local computer:
LIBS =  -L"${ZGELSQUAD}" -lzgelsquad -L"${DGELSDQUAD}" -ldgelsdquad -L"${LAPACKPATH}" -llapack -lrefblas

#-----------------------------------------------------------------------------------------------------------------------

# Compiler

# On matter:
#F90 = ifort 
#F90FLAGS =  -O2

# On India:
#F90 = gfortran 
#F90FLAGS =  -O2 # -fopenmp  -g -Wall -fbounds-check -Waliasing -fdump-core  -Wreturn-type 

# On local computer:
F90 = gfortran
F90FLAGS = -O2  # -g -Wall -fbounds-check -Waliasing -fdump-core  -Wreturn-type

LDFLAGS = $(LIBS)

#-----------------------------------------------------------------------------------------------------------------------

all: gitR $(PROG)

gitR: gitversion_template.f90
	./setgitversion.sh 


$(PROG): $(OBJS)
	$(F90) $(LDFLAGS) -o $@ $(OBJS) $(LIBS)

clean:
	rm -f $(PROG) $(OBJS) *.mod


.SUFFIXES: $(SUFFIXES) .f90 .F90 .f .cpp

.f.o:
	$(F77) $(F77FLAGS) -c $<
.f90.o:
	$(F90) $(F90FLAGS) -c $<
.F90.o:
	$(F90) $(F90FLAGS) -c $<
.f90.mod:
	$(F90) $(F90FLAGS) -c $<
.F90.mod:
	$(F90) $(F90FLAGS) -c $<

.mod.o:
	$(F90) $(F90FLAGS) -c $<

.cpp.o:
	$(CC) $(INCLUDE) $(LIBS) -c $<

